# nginx.conf
events {}

http {
  server {
    listen 8443 ssl;
    server_name node1.test;

    ssl_certificate /etc/nginx/certs/node1.crt;
    ssl_certificate_key /etc/nginx/certs/node1.key;

    location = /default {
        if ($request_method != POST) {
            return 405;
        }

        if ($arg_query = "SELECT hostName()") {
            return 200 "node1.test\n";
        }

        return 400 "Unsupported query\n";
    }

    location / {
      return 200 "node1.test served\n";
    }
  }

  server {
    listen 8443 ssl;
    server_name node2.test;

    ssl_certificate /etc/nginx/certs/node2.crt;
    ssl_certificate_key /etc/nginx/certs/node2.key;

    location = /default {
        if ($request_method != POST) {
            return 405;
        }

        if ($arg_query = "SELECT hostName()") {
            return 200 "node2.test\n";
        }

        return 400 "Unsupported query\n";
    }

    location / {
      return 200 "node2.test served\n";
    }
  }
}

